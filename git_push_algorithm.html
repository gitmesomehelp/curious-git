<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>An algorithm for git push &mdash; pydagogue 0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pydagogue 0.2 documentation" href="index.html" />
    <link rel="next" title="Reading git objects" href="reading_git_objects.html" />
    <link rel="prev" title="How do git submodules work?" href="git_submodules.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="an-algorithm-for-git-push">
<h1>An algorithm for git push<a class="headerlink" href="#an-algorithm-for-git-push" title="Permalink to this headline">¶</a></h1>
<p>We saw how git stores its object in <a class="reference internal" href="curious_git.html"><em>The curious coder&#8217;s guide to git</em></a>.</p>
<p>Now we know about how git stores its objects, we can work out how git knows
which objects to copy when it does a push.</p>
<div class="section" id="paths-through-commits">
<h2>Paths through commits<a class="headerlink" href="#paths-through-commits" title="Permalink to this headline">¶</a></h2>
<p>Git commits form a graph.  The commits are the <em>nodes</em> in the graph.  Each
commit (except the first) has one or more parents, stored as hash references
in the commit object. The references to commit parents are the links
between nodes that form the <em>edges</em> in the graph.</p>
<p>The output of <code class="docutils literal"><span class="pre">git</span> <span class="pre">log</span> <span class="pre">--graph</span></code> shows the sequence of commits as a graph,
with commits as nodes and parent links as edges.  Here&#8217;s some example output
from the <code class="docutils literal"><span class="pre">git</span> <span class="pre">log</span></code> command with flags to make the graph structure more
obvious:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>desktop<span class="o">]</span><span class="nv">$ </span>git log --graph --oneline 9c85696
* 9c85696 Buff up the paper some more
*   570e6df Merge branch <span class="s1">&#39;josephines-branch&#39;</span>
<span class="p">|</span><span class="se">\ </span> 
<span class="p">|</span> * 740d747 Expand the introduction
* <span class="p">|</span> 191c946 More fun with fudge
<span class="p">|</span>/  
* 09e59b6 Revert to original script <span class="p">&amp;</span> figure
* 3a666f1 Add references
* cd5feb3 Change parameters of analysis
* f253e97 Add another fudge factor
* de82e02 Add first draft of paper
* adbb65e First backup of my amazing idea
</pre></div>
</div>
<p>If we start at a particular commit, and then track back following only one
parent for each commit, this is a <em>path</em> in the <em>commit history</em>.</p>
</div>
<div class="section" id="an-algorithm">
<h2>An algorithm<a class="headerlink" href="#an-algorithm" title="Permalink to this headline">¶</a></h2>
<p>Something like this algorithm might do the job:</p>
<ol class="arabic simple">
<li>Get the commit hash corresponding the branch we are going to push;</li>
<li>Follow every commit path (see above)back from this commit, until we hit a
commit hash (filename) that the remote has.  All the previous commits on
the path, that the remote does not have, are <em>missing commits</em>;</li>
<li>For every <em>missing commit</em> get the corresponding tree (directory listing)
object.  If the tree object is not in the remote objects directory, add to
the list of <em>missing trees</em>;</li>
<li>For every <em>missing tree</em> read the tree directory listing. Find any blob
(file) objects in the directory listing that are not in the remote objects
directory, add to the list of <em>missing blob</em> objects <a class="footnote-reference" href="#sub-trees" id="id1">[1]</a>;</li>
<li>Copy all <em>missing commit</em>, <em>missing tree</em> and <em>missing blob</em> objects to the
remote objects directory;</li>
<li>Update the remote branch to point to the same commit as the local branch;</li>
<li>Update the local record of the last known position of the remote branch to
point to the same commit.</li>
</ol>
<p>There&#8217;s a specific example of <code class="docutils literal"><span class="pre">git</span> <span class="pre">push</span></code> at <a class="reference internal" href="curious_remotes.html#git-push"><span>git push – synchronizing repositories</span></a>. Here is how
that example would follow our algorithm:</p>
<ol class="arabic simple">
<li>We look up the hash for <code class="docutils literal"><span class="pre">master</span></code>, and we get <code class="docutils literal"><span class="pre">9c856962ed62de4307ba0e7cca66624798d662dd</span></code> (abbreviated as
<code class="docutils literal"><span class="pre">9c85696</span></code>);</li>
<li>We follow all commit history paths back from <code class="docutils literal"><span class="pre">9c85696</span></code> to check for
missing commits. We start with <code class="docutils literal"><span class="pre">9c85696</span></code>. The remote does not have a
matching file in <code class="docutils literal"><span class="pre">objects</span></code>, so this is a missing commit. We only have one
path to follow, because <code class="docutils literal"><span class="pre">9c85696</span></code> has only one parent –
<code class="docutils literal"><span class="pre">570e6df01efe50b4cdefdbc4bb6b74b1e6863930</span></code> – and the remote does have a corresponding object, so
we can stop looking for missing commits;</li>
<li>We only have one missing commit, <code class="docutils literal"><span class="pre">9c85696</span></code>.  We look in the contents of
<code class="docutils literal"><span class="pre">9c85696</span></code> to find the tree object hash.  This is <code class="docutils literal"><span class="pre">5479026d5fc400a536f9a89b5f60b18604d64b13</span></code>.  We
check for this object in the remote objects directory, and sure enough, it
is missing. We add this tree to the list of missing trees;</li>
<li>We only have one missing tree – <code class="docutils literal"><span class="pre">5479026d5fc400a536f9a89b5f60b18604d64b13</span></code>. We look in the contents
of this tree object and check in the remote object directory for each
object in this listing. The only missing object is <code class="docutils literal"><span class="pre">67a2b3a80e9419cfedb299c322c0da66123c0485</span></code>;</li>
<li>We copy the objects for the missing commits (<code class="docutils literal"><span class="pre">570e6df01efe50b4cdefdbc4bb6b74b1e6863930</span></code>), missing
trees (<code class="docutils literal"><span class="pre">5479026d5fc400a536f9a89b5f60b18604d64b13</span></code>) and missing blobs (<code class="docutils literal"><span class="pre">67a2b3a80e9419cfedb299c322c0da66123c0485</span></code>) to the
remote objects directory;</li>
<li>We set remote <code class="docutils literal"><span class="pre">refs/heads/master</span></code> to contain the hash <code class="docutils literal"><span class="pre">9c85696</span></code>;</li>
<li>Set the local <code class="docutils literal"><span class="pre">refs/remotes/usb_backup/master</span></code> to contain <code class="docutils literal"><span class="pre">9c85696</span></code>.</li>
</ol>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="sub-trees" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>You have probably worked out by now that git directory
listings can have files (called &#8220;blobs&#8221;) and subdirectories (&#8220;trees&#8221;) (see
<a class="reference internal" href="git_object_types.html"><em>Types of git objects</em></a>).  When doing the copy, we actually have to recurse
into any sub-directories to get needed file (&#8220;blob&#8221;) and subdirectory
(&#8220;tree&#8221;) objects.  But, you get the idea.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">An algorithm for git push</a><ul>
<li><a class="reference internal" href="#paths-through-commits">Paths through commits</a></li>
<li><a class="reference internal" href="#an-algorithm">An algorithm</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="git_submodules.html" title="previous chapter">How do git submodules work?</a></li>
      <li>Next: <a href="reading_git_objects.html" title="next chapter">Reading git objects</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/git_push_algorithm.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2009-2016 - Matthew Brett.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/git_push_algorithm.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>